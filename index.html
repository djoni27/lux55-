<!DOCTYPE html>
<html :lang="currentLang" :dir="currentLang === 'ar' ? 'rtl' : 'ltr'">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Platinum Store Pro | المتجر البلاتيني المطور</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700;900&family=Cairo:wght@400;700;900&family=Plus+Jakarta+Sans:wght@300;500;700;800&family=Almarai:wght@300;400;700;800&family=Amiri:wght@400;700&family=Poppins:wght@300;400;700;900&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@^2.39.0"
  }
}
</script>
</head>
<body>
    <div id="app" v-cloak :style="bodyStyle" :class="'mode-' + settings.cardMode">

        <div v-if="loading" class="fixed inset-0 z-[1000] bg-[#0f172a] flex flex-col items-center justify-center text-white">
            <div class="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="font-bold tracking-widest text-blue-400 animate-pulse">{{ t.loading }}</p>
        </div>

        <template v-else>
            <div class="fixed bottom-6 right-6 z-[100] flex flex-col gap-3">
                <button @click="showAI = true" class="w-14 h-14 bg-blue-600 text-white rounded-full shadow-2xl flex items-center justify-center hover:scale-110 active:scale-95 transition-all border-4 border-white/20">
                    <i class="fa-solid fa-brain text-xl"></i>
                </button>
                <button @click="toggleAdmin" class="w-14 h-14 bg-slate-900 text-white rounded-full shadow-2xl flex items-center justify-center hover:scale-110 active:scale-95 transition-all border-4 border-white/20">
                    <i class="fa-solid fa-sliders text-xl"></i>
                </button>
            </div>

            <nav class="sticky top-0 z-[200] backdrop-blur-xl bg-white/10 border-b border-white/10 px-4 py-3">
                <div class="container mx-auto flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <img v-if="settings.logo" :src="settings.logo" class="h-10 object-contain drop-shadow-lg">
                        <h1 v-else class="text-xl font-black" :style="{ color: textColor }">{{ settings.storeName }}</h1>
                    </div>
                    <button @click="showCart = true" class="relative p-2 bg-white/10 rounded-xl border border-white/10">
                        <i class="fa-solid fa-shopping-bag text-xl" :style="{ color: textColor }"></i>
                        <span v-if="cart.length" class="absolute -top-1 -right-1 bg-blue-600 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold border-2 border-[#0f172a]">{{ cart.length }}</span>
                    </button>
                </div>
            </nav>

            <header class="pt-12 pb-10 px-6 text-center">
                <h2 class="hero-title max-w-3xl mx-auto drop-shadow-2xl mb-8" :style="heroTextStyle">
                    {{ settings.heroTitle }}
                </h2>

                <div class="max-w-md mx-auto mb-8 relative">
                    <input type="text" v-model="searchQuery" :placeholder="t.searchPlaceholder"
                        class="w-full py-4 px-12 rounded-2xl bg-white/5 border border-white/20 backdrop-blur-xl transition-all focus:bg-white focus:text-slate-900 outline-none placeholder:text-white/30"
                        :style="{ color: searchQuery ? '#0f172a' : textColor }">
                    <i class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-blue-500"></i>
                </div>

                <div class="flex gap-2 overflow-x-auto pb-4 no-scrollbar justify-center">
                    <button @click="filter = 'all'"
                        :class="filter == 'all' ? 'bg-blue-600 text-white' : 'bg-white/5 text-white'"
                        class="px-6 py-2 rounded-xl font-bold whitespace-nowrap border border-white/10 text-xs">
                        {{ t.all }}
                    </button>
                    <button v-for="cat in categories" :key="cat" @click="filter = cat"
                        :class="filter == cat ? 'bg-blue-600 text-white' : 'bg-white/5 text-white'"
                        class="px-6 py-2 rounded-xl font-bold whitespace-nowrap border border-white/10 text-xs">
                        {{ cat }}
                    </button>
                </div>
            </header>

            <main class="container mx-auto px-4 pb-24">
                <div class="product-grid">
                    <div v-for="(p, i) in filteredProducts" :key="p.id" class="product-card group" @click="selectedProduct = p">
                        <div class="aspect-square overflow-hidden relative bg-slate-800 rounded-t-xl">
                            <img :src="p.image" class="w-full h-full object-cover" loading="lazy">
                            <div class="absolute top-2 right-2">
                                <span class="bg-black/60 backdrop-blur text-white text-[8px] font-bold px-2 py-1 rounded-full uppercase">{{ p.category }}</span>
                            </div>
                        </div>
                        <div class="p-3 flex flex-col flex-grow bg-white/5 backdrop-blur-sm">
                            <h3 class="font-bold text-sm line-clamp-1 mb-2" :class="textColorClass">{{ p.name }}</h3>
                            <div class="mt-auto flex justify-between items-center">
                                <span class="text-blue-500 font-black text-sm">{{ Number(p.price).toLocaleString() }} <small class="text-[8px]">{{ t.currency }}</small></span>
                                <button @click.stop="addToCart(p)" class="w-8 h-8 rounded-lg bg-blue-600 text-white flex items-center justify-center active:scale-90 transition-all">
                                    <i class="fa-solid fa-plus text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <div v-if="showAI" class="fixed inset-0 z-[500] bg-black/80 backdrop-blur-md flex items-end sm:items-center justify-center p-4" @click.self="showAI = false">
                <div class="bg-white w-full max-w-lg rounded-t-3xl sm:rounded-3xl overflow-hidden flex flex-col h-[80vh] animate-slide-up">
                    <div class="p-4 bg-blue-600 text-white flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-robot"></i>
                            <span class="font-bold">{{ t.aiTitle }}</span>
                        </div>
                        <button @click="showAI = false" class="p-2"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                    <div class="flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar" id="ai-chat">
                        <div v-for="(msg, idx) in aiMessages" :key="idx"
                            :class="msg.role === 'user' ? 'bg-blue-50 ml-8 rounded-l-2xl rounded-tr-2xl' : 'bg-slate-100 mr-8 rounded-r-2xl rounded-tl-2xl'"
                            class="p-4 text-sm font-medium">
                            <div v-if="msg.thinking" class="mb-2 text-[10px] text-blue-400 italic flex items-center gap-2">
                                <i class="fa-solid fa-brain animate-pulse"></i> {{ t.aiThinking }}
                                <div class="thinking-dots"><span></span><span></span><span></span></div>
                            </div>
                            <div class="whitespace-pre-wrap leading-relaxed">{{ msg.content }}</div>
                        </div>
                    </div>
                    <div class="p-4 border-t flex gap-2">
                        <input v-model="aiInput" @keyup.enter="askAI" :placeholder="t.aiPlaceholder" class="flex-1 bg-slate-100 p-3 rounded-xl outline-none text-sm">
                        <button @click="askAI" :disabled="aiLoading" class="w-12 h-12 bg-blue-600 text-white rounded-xl disabled:opacity-50">
                            <i class="fa-solid fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div v-if="showCart" class="fixed inset-0 z-[500] bg-black/60 backdrop-blur-sm flex justify-end" @click.self="showCart = false">
                <div class="bg-white w-full max-w-sm h-full flex flex-col animate-slide-right">
                    <div class="p-6 border-b flex justify-between items-center">
                        <h2 class="text-xl font-black uppercase tracking-tighter">{{ t.cartTitle }}</h2>
                        <button @click="showCart = false" class="p-2"><i class="fa-solid fa-times"></i></button>
                    </div>
                    <div class="flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar">
                        <div v-if="cart.length === 0" class="text-center py-20 text-slate-300">
                            <i class="fa-solid fa-cart-plus text-6xl mb-4 opacity-20"></i>
                            <p class="font-bold">{{ t.emptyCart }}</p>
                        </div>
                        <div v-for="(item, i) in cart" :key="i" class="flex gap-4 bg-slate-50 p-3 rounded-2xl items-center">
                            <img :src="item.image" class="w-16 h-16 rounded-xl object-cover">
                            <div class="flex-1">
                                <h4 class="font-bold text-xs">{{ item.name }}</h4>
                                <p class="text-blue-600 font-black text-sm">{{ item.price }} {{ t.currency }}</p>
                            </div>
                            <button @click="cart.splice(i, 1)" class="text-red-400 p-2"><i class="fa-solid fa-trash-alt"></i></button>
                        </div>
                    </div>
                    <div v-if="cart.length > 0" class="p-6 bg-slate-50 border-t">
                        <div class="flex justify-between font-black text-lg mb-6">
                            <span>{{ t.total }}</span>
                            <span class="text-blue-600">{{ cartTotal.toLocaleString() }} {{ t.currency }}</span>
                        </div>
                        <button @click="checkout" class="w-full bg-green-500 text-white py-4 rounded-2xl font-black text-lg shadow-lg flex justify-center items-center gap-3">
                            <i class="fa-brands fa-whatsapp text-2xl"></i> {{ t.checkoutBtn }}
                        </button>
                    </div>
                </div>
            </div>

            <div v-if="showAdmin" class="fixed inset-0 z-[600] bg-slate-900/95 backdrop-blur-xl flex items-center justify-center p-2">
                <div class="admin-modal bg-white shadow-2xl overflow-hidden flex flex-col animate-scale-up">
                    <div class="p-4 bg-slate-950 text-white flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center"><i class="fa-solid fa-gear"></i></div>
                            <h2 class="font-black text-sm uppercase tracking-tighter">{{ t.adminTitle }}</h2>
                        </div>
                        <div class="flex gap-2">
                            <button @click="saveToCloud" class="bg-emerald-500 px-4 py-2 rounded-lg text-[10px] font-black uppercase">
                                <i v-if="saving" class="fa-solid fa-spinner fa-spin"></i>
                                <span v-else>{{ t.saveBtn }}</span>
                            </button>
                            <button @click="showAdmin = false" class="bg-white/10 w-10 h-10 rounded-lg flex items-center justify-center"><i class="fa-solid fa-xmark"></i></button>
                        </div>
                    </div>

                    <div class="flex flex-1 overflow-hidden">
                        <div class="w-16 bg-slate-50 border-r flex flex-col items-center py-4 gap-6">
                            <button v-for="tab in adminTabs" :key="tab.id" @click="activeTab = tab.id"
                                :class="activeTab==tab.id ? 'text-blue-600' : 'text-slate-300'"
                                class="text-xl transition-all">
                                <i :class="tab.icon"></i>
                            </button>
                        </div>

                        <div class="flex-1 p-4 overflow-y-auto custom-scrollbar bg-white">
                            <div v-if="activeTab === 'general'" class="space-y-6 animate-fade-in">
                                <div class="space-y-4">
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">{{ t.languageSelect }}</label>
                                    <div class="flex gap-3">
                                        <button v-for="lang in ['ar', 'en', 'fr']" :key="lang" @click="currentLang = lang"
                                            :class="currentLang == lang ? 'bg-blue-600 text-white' : 'bg-gray-100'"
                                            class="px-6 py-2 rounded-xl font-bold transition uppercase">
                                            {{ lang === 'ar' ? 'عربي' : lang.toUpperCase() }}
                                        </button>
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">{{ t.storeNameLabel }}</label>
                                    <input v-model="settings.storeName" class="w-full bg-slate-50 p-4 rounded-xl border-none focus:ring-2 focus:ring-blue-500 font-bold">
                                </div>
                                <div class="space-y-4">
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">{{ t.phoneLabel }}</label>
                                    <input v-model="settings.phone" class="w-full bg-slate-50 p-4 rounded-xl border-none focus:ring-2 focus:ring-blue-500 font-bold">
                                </div>
                                <div class="space-y-4">
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">{{ t.heroTitleLabel }}</label>
                                    <textarea v-model="settings.heroTitle" rows="3" class="w-full bg-slate-50 p-4 rounded-xl border-none focus:ring-2 focus:ring-blue-500 font-bold resize-none"></textarea>
                                </div>
                                <div class="space-y-4">
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">{{ t.logoLabel }}</label>
                                    <div class="flex items-center gap-4 p-4 bg-slate-50 rounded-xl">
                                        <img v-if="settings.logo" :src="settings.logo" class="w-12 h-12 object-contain rounded-lg">
                                        <div class="flex-1 relative cursor-pointer text-center py-3 bg-white rounded-lg border-2 border-dashed border-slate-200">
                                            <span class="text-[10px] font-bold text-slate-400">{{ t.uploadLogo }}</span>
                                            <input type="file" accept="image/*" @change="(e) => handleUpload(e, 'logo')" class="absolute inset-0 opacity-0 cursor-pointer">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div v-if="activeTab === 'design'" class="space-y-6 animate-fade-in">
                                <div class="grid grid-cols-2 gap-3">
                                    <button v-for="mode in modes" :key="mode.id" @click="settings.cardMode = mode.id"
                                        :class="settings.cardMode == mode.id ? 'border-blue-500 bg-blue-50' : 'border-slate-100'"
                                        class="p-4 rounded-xl border-2 flex flex-col items-center gap-2 transition-all">
                                        <i :class="mode.icon" class="text-lg" :style="{color: mode.color}"></i>
                                        <span class="text-[9px] font-black uppercase">{{ mode.name }}</span>
                                    </button>
                                </div>
                                <div class="space-y-4">
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">{{ t.fontSize }}</label>
                                    <input type="range" min="1.5" max="6" step="0.5" v-model="settings.heroSize" class="w-full accent-blue-600">
                                </div>
                                <div class="space-y-4">
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">{{ t.bgLabel }}</label>
                                    <div class="relative cursor-pointer text-center py-6 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200">
                                        <span class="text-xs font-bold text-slate-400">{{ t.uploadBg }}</span>
                                        <input type="file" accept="image/*" @change="(e) => handleUpload(e, 'bg')" class="absolute inset-0 opacity-0 cursor-pointer">
                                    </div>
                                </div>
                            </div>

                            <div v-if="activeTab === 'products'" class="space-y-6 animate-fade-in">
                                <div class="bg-blue-600 p-6 rounded-2xl shadow-xl text-white space-y-4">
                                    <h3 class="text-lg font-black uppercase">{{ isEditing ? t.editProduct : t.addProduct }}</h3>
                                    <input v-model="productForm.name" :placeholder="t.prodNamePlaceholder" class="w-full bg-white/10 p-3 rounded-xl border border-white/20 outline-none focus:bg-white focus:text-slate-900 transition-all text-sm">
                                    <input v-model="productForm.price" type="number" :placeholder="t.pricePlaceholder" class="w-full bg-white/10 p-3 rounded-xl border border-white/20 outline-none focus:bg-white focus:text-slate-900 transition-all text-sm">
                                    <input v-model="productForm.category" :placeholder="t.catPlaceholder" list="catsList" class="w-full bg-white/10 p-3 rounded-xl border border-white/20 outline-none focus:bg-white focus:text-slate-900 transition-all text-sm">
                                    <textarea v-model="productForm.description" :placeholder="t.descPlaceholder" rows="2" class="w-full bg-white/10 p-3 rounded-xl border border-white/20 outline-none focus:bg-white focus:text-slate-900 transition-all text-sm resize-none"></textarea>
                                    <datalist id="catsList"><option v-for="c in categories" :key="c" :value="c"></option></datalist>
                                    <div class="relative bg-white/10 border-2 border-dashed border-white/30 py-4 rounded-xl text-center cursor-pointer">
                                        <span class="text-[10px] font-bold">{{ t.uploadProductImg }}</span>
                                        <input type="file" accept="image/*" @change="(e) => handleUpload(e, 'product')" class="absolute inset-0 opacity-0 cursor-pointer">
                                    </div>
                                    <button @click="saveProduct" class="w-full bg-white text-blue-600 py-3 rounded-xl font-black shadow-lg">
                                        {{ isEditing ? t.saveEdit : t.addToList }}
                                    </button>
                                </div>
                                <div class="grid grid-cols-1 gap-3">
                                    <div v-for="(p, i) in products" :key="p.id" class="flex items-center gap-4 bg-slate-50 p-3 rounded-xl border border-slate-100">
                                        <img :src="p.image" class="w-12 h-12 rounded-lg object-cover">
                                        <div class="flex-1 min-w-0">
                                            <h4 class="font-bold text-xs truncate">{{ p.name }}</h4>
                                            <span class="text-[10px] text-blue-500 font-bold">{{ p.price }} {{ t.currency }}</span>
                                        </div>
                                        <div class="flex gap-2">
                                            <button @click="editProduct(i)" class="w-8 h-8 rounded-lg bg-blue-50 text-blue-500 flex items-center justify-center"><i class="fa-solid fa-edit"></i></button>
                                            <button @click="deleteProduct(p.id)" class="w-8 h-8 rounded-lg bg-red-50 text-red-400 flex items-center justify-center"><i class="fa-solid fa-trash"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="selectedProduct" class="fixed inset-0 z-[400] bg-black/90 backdrop-blur-xl flex items-end sm:items-center justify-center p-0 sm:p-4" @click.self="selectedProduct = null">
                <div class="bg-white w-full max-w-2xl rounded-t-[40px] sm:rounded-[40px] overflow-hidden shadow-2xl relative animate-slide-up sm:animate-scale-up">
                    <button @click="selectedProduct = null" class="absolute top-6 right-6 bg-slate-100 w-10 h-10 rounded-full flex items-center justify-center z-10 transition-all shadow-md">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                    <div class="flex flex-col h-full max-h-[90vh] overflow-y-auto no-scrollbar">
                        <div class="aspect-square bg-slate-100">
                            <img :src="selectedProduct.image" class="w-full h-full object-cover">
                        </div>
                        <div class="p-8 flex flex-col">
                            <span class="bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-[10px] font-black uppercase w-fit mb-4">{{ selectedProduct.category }}</span>
                            <h2 class="text-3xl font-black mb-4 tracking-tight">{{ selectedProduct.name }}</h2>
                            <p class="text-slate-500 mb-10 text-sm leading-relaxed">{{ selectedProduct.description || t.prodDescDefault }}</p>
                            <div class="flex items-center justify-between mb-8">
                                <span class="text-4xl font-black text-blue-600">{{ selectedProduct.price }} <small class="text-sm font-bold">{{ t.currency }}</small></span>
                            </div>
                            <div class="grid grid-cols-1 gap-3">
                                <button @click="addToCart(selectedProduct); selectedProduct = null" class="bg-slate-900 text-white py-5 rounded-2xl font-black flex items-center justify-center gap-3 active:scale-95 transition-all">
                                    <i class="fa-solid fa-cart-plus text-xl"></i> {{ t.addToCart }}
                                </button>
                                <button @click="nativeShare(selectedProduct)" class="bg-slate-100 text-slate-800 py-5 rounded-2xl font-black flex items-center justify-center gap-3">
                                    <i class="fa-solid fa-share-nodes text-xl"></i> {{ t.shareProduct }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </template>
    </div>

    <script type="module" src="index.tsx"></script>
</body>
</html>
